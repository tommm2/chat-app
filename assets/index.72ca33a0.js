import{c as P,a as A,r as E,o as v,b as U,f as m,d as S,e as b,g as f,h as D}from"./vendor.b0e8f9d3.js";const T=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function s(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerpolicy&&(o.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?o.credentials="include":r.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(r){if(r.ep)return;r.ep=!0;const o=s(r);fetch(r.href,o)}};T();const M="modulepreload",d={},L="/chat-app/",h=function(t,s){return!s||s.length===0?t():Promise.all(s.map(a=>{if(a=`${L}${a}`,a in d)return;d[a]=!0;const r=a.endsWith(".css"),o=r?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${o}`))return;const n=document.createElement("link");if(n.rel=r?"stylesheet":M,r||(n.as="script",n.crossOrigin=""),n.href=a,document.head.appendChild(n),r)return new Promise((c,p)=>{n.addEventListener("load",c),n.addEventListener("error",p)})})).then(()=>t())},I=[{name:"Index",path:"/",component:()=>h(()=>import("./Index.40947198.js"),["assets/Index.40947198.js","assets/Index.435a6210.css","assets/vendor.b0e8f9d3.js"]),redirect:"/login",children:[{name:"Login",path:"login",component:()=>h(()=>import("./Login.089300f3.js"),["assets/Login.089300f3.js","assets/Login.312da996.css","assets/vendor.b0e8f9d3.js"])},{name:"Chat",path:"chat",component:()=>h(()=>import("./Chat.ebf7d4fe.js"),["assets/Chat.ebf7d4fe.js","assets/Chat.abe037cd.css","assets/vendor.b0e8f9d3.js"]),meta:{requiresAuth:!0}},{name:"Register",path:"register",component:()=>h(()=>import("./Register.0e66992f.js"),["assets/Register.0e66992f.js","assets/Register.fc68c845.css","assets/vendor.b0e8f9d3.js"])}]},{path:"/:catchAll(.*)",redirect:"/login"}],u=P({linkActiveClass:"active",history:A(),routes:I,scrollBehavior(e,t,s){return{top:0}}});var O=(e,t)=>{for(const[s,a]of t)e[s]=a;return e};const R={};function N(e,t){const s=E("router-view");return v(),U(s)}var G=O(R,[["render",N]]);const g={apiKey:"AIzaSyCSei4bGBnDPGw3vOMuTPeR1mg4Qq5UopA",authDomain:"vue-chat-app-e373f.firebaseapp.com",projectId:"vue-chat-app-e373f",databaseURL:"https://vue-chat-app-e373f-default-rtdb.asia-southeast1.firebasedatabase.app",storageBucket:"vue-chat-app-e373f.appspot.com",messagingSenderId:"191258709366",appId:"1:191258709366:web:1007e9d9633ff375937e57",measurementId:"G-D5D6P8N5Y1"},l=m.initializeApp(g).database(),i=m.initializeApp(g).auth();var C={state:()=>({isShow:!1,message:"",style:""}),mutations:{UPDATE_MSG(e,t){e.isShow=t.isShow,e.message=t.msg,e.style=t.style}},actions:{removeMsg({commit:e},t){setTimeout(()=>{e("UPDATE_MSG",t)},1500)}}};const _=S({strict:!0,state:()=>({uid:"",routeName:"",showMenu:!1,onlineUser:[],messages:[]}),mutations:{UPDATE_ROUTE(e,t){e.routeName=t},UPDATE_UID(e,t){e.uid=t},UPDATE_MENU(e,t){e.showMenu=t},UPDATE_ONLINE_USER(e,t){e.onlineUser=t},UPDATE_CHAT_MSG(e,t){e.messages=t}},actions:{async register({dispatch:e,commit:t},s){const{username:a,email:r,password:o}=s;try{await i.createUserWithEmailAndPassword(r,o),await i.currentUser.updateProfile({displayName:a,photoURL:"https://i.postimg.cc/mrtfw2dd/anonymous.png"}),await t("UPDATE_MSG",{isShow:!0,msg:"\u8A3B\u518A\u6210\u529F!",style:"success"}),await u.push("/login"),await e("removeMsg",{isShow:!1,msg:"",style:""})}catch(n){t("UPDATE_MSG",{isShow:!0,msg:"\u6B64\u5E33\u865F\u5DF2\u88AB\u4F7F\u7528",style:"error"}),e("removeMsg",{isShow:!1,msg:"",style:""})}},async threePartLogin({dispatch:e,commit:t},s){let a=new m.auth.GoogleAuthProvider;s==="facebook"&&(a=new m.auth.FacebookAuthProvider);try{await i.signInWithPopup(a),await t("UPDATE_MSG",{isShow:!0,msg:"\u767B\u5165\u6210\u529F",style:"success"}),await u.push("/chat"),await e("removeMsg",{isShow:!1,msg:"",style:""})}catch{}},async userLogin({dispatch:e,commit:t},s){const{email:a,password:r}=s;try{await i.signInWithEmailAndPassword(a,r),await t("UPDATE_MSG",{isShow:!0,msg:"\u767B\u5165\u6210\u529F",style:"success"}),await u.push("/chat"),await e("removeMsg",{isShow:!1,msg:"",style:""})}catch{t("UPDATE_MSG",{isShow:!0,msg:"\u67E5\u7121\u6B64\u7528\u6236",style:"error"}),e("removeMsg",{isShow:!1,msg:"",style:""})}},pushMessage({commit:e},t){l.ref("/messages").push(t)},getMessage({commit:e},t){l.ref("/messages").on("value",s=>{e("UPDATE_CHAT_MSG",s.val())})},userPresence({commit:e},t){const{uid:s,displayName:a,photoURL:r}=t;let o=l.ref(`presence/${s}`);l.ref(".info/connected").on("value",c=>{if(c.val()){let p={user:a,online:!0,uid:s,photoUrl:r},y={user:a,online:!1,uid:s,photoUrl:r};o.onDisconnect().set(y).then(()=>{o.set(p)})}}),l.ref("presence").on("value",c=>{e("UPDATE_ONLINE_USER",c.val())})}},modules:{alert:C}});b({validateOnInput:!0});f("username",e=>!e||!e.length?"* Username can't be empty":e.length<3||e.length>10?"* Username must between 3 ~ 10 character":!0);f("email",e=>{if(!e||!e.length)return"* Email can't be empty";var t=/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;return t.test(e)?!0:"* Email must be a valid email"});f("password",e=>!e||!e.length?"* Password can't be empty":e.length<6||e.length>12?"* Passowrd must between 6 ~ 12 character":!0);f("confirmed",(e,[t])=>e!==t||!e||!e.length?"* Password must match":!0);let w;i.onAuthStateChanged(()=>{w||(w=D(G).use(u).use(_).mount("#app"))});u.beforeEach((e,t)=>{if(_.commit("UPDATE_MENU",!1),e.meta.requiresAuth&&!i.currentUser)return{name:"Login",query:{redirect:e.fullPath}}});export{O as _,i as a,l as d};
